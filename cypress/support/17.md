
Cypress.Commands.add("login", () => {
  const setup = () => {
    cy.visit("./src/index.html?skipCaptcha=true")
    cy.contains("button", "Login").click()
  }

  const validate = () => {
    cy.visit("./src/index.html")
    cy.contains("button", "Login", { timeout: 1000 })
      .should("not.be.visible")
  }

  const options = {
    cacheAcrossSpecs: true,
    validate
  }

  cy.session(
    "sessionId",
    setup,
    options
  )
})

```

2. Atualize os arquivos `cypress/e2e/a11y.cy.js` e `cypress/e2e/cypress-simulator.cy.js` para que façam uso do comando `cy.login()`
3. Após o login, lembre-se de visitar a URL adequada, dependendo se quer ou não pular o captcha.

## Exercício 2 🎯 - Comando `cy.run`

Crie um comando customizado chamado `cy.run`, o qual recebe como argumento um comando (como uma _string_). Tal comando deve abstrair a lógica de digitar a _string_ recebida como argumento no campo de área de texto (`textarea`), além do clique no botão _Run_.

> 🙊

```js
Cypress.Commands.add('run', cmd => {
  cy.get("textarea[placeholder='Write your Cypress code here...']")
    .type(cmd)
  cy.contains("button", "Run").click()
})

```

## Conteúdos sugeridos 📚

- [Como criar comandos customizados com Cypress](https://talkingabouttesting.com/2021/02/10/como-criar-comandos-customizados-com-cypress/)
- [Cypress Page Object vs GUI Custom Commands](https://youtu.be/1OkfwHUJ-fk)
- [_Playlist_ cy.session do Canal TAT no YouTube](https://www.youtube.com/playlist?list=PL-eblSNRj0QF1RA4fd9FrDVov_uyYfCAL)
- [Autentique testes mais rápido com o comando cy.session](https://talkingabouttesting.com/2021/08/07/autentique-testes-mais-rapido-com-o-comando-cy-session/)

## Mostre ao mundo o que você aprendeu 🌎

Para mostrar à sua rede profissional o que você aprendeu nesta aula, publique o seguinte no LinkedIn.

> Estou fazendo o curso "_Cypress Simulator_" da escola online Talking About Testing, no qual aprendi como criar comandos customizados com Cypress e como criar testes otimizados com uso da funcionalidade cy.session (compartilhando a sessão entre _specs_ e validando e re-criando a sessão quando a mesma é invalidada). #TalkingAboutTesting #EscolaTAT #CypressSimulator #Cypress
>
> 👨‍🏫 Lembre-se de me marcar em sua publicação. [Aqui está meu perfil no LinkedIn](https://www.linkedin.com/in/walmyr-lima-e-silva-filho).

___

Parabéns! 🎉 Vamos para a [lição 18](./18.md) para implementar uma esteira de integração contínua que executa sempre que mudanças forem enviadas ao GitHub.
